{"ast":null,"code":"var _jsxFileName = \"/Users/abhinav/Desktop/itilapp/client/src/components/ticketpage.js\";\nimport axios from 'axios';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { updateTicket } from '../actions/ticketActions';\nimport { returnErrors } from '../actions/errorActions';\nimport { addComment } from '../actions/commentActions';\nimport { findUser } from '../actions/userActions';\nimport PropTypes from 'prop-types';\nimport LoadingScreen from './loadingscreen';\nimport { Form, Button, Table, Row, Col } from 'react-bootstrap';\nimport dompurify from 'dompurify';\nimport moment from 'moment';\nconst sanitizer = dompurify.sanitize;\n\nclass TicketPage extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      status: '',\n      created: '',\n      open: '',\n      updated: '',\n      title: '',\n      description: '',\n      customerName: '',\n      customerContact: '',\n      author: '',\n      comments: [],\n      assignedTo: '',\n      commentToggle: false,\n      original: {\n        status: '',\n        created: '',\n        open: '',\n        updated: '',\n        title: '',\n        description: '',\n        customerName: '',\n        customerContact: '',\n        author: '',\n        comments: [],\n        assignedTo: ''\n      },\n      commentText: '',\n      loading: false,\n      errors: {}\n    };\n\n    this.onChange = e => {\n      this.setState({\n        [e.target.id]: e.target.value\n      });\n    };\n\n    this.commentPost = async text => {\n      if (text.length > 0) {\n        const {\n          id\n        } = this.props.match.params;\n        const userId = this.props.auth.user.id;\n        const username = this.props.auth.user.name;\n        const newComment = {\n          text: text,\n          author: {\n            id: userId,\n            name: username\n          }\n        };\n        await this.props.addComment(id, newComment);\n        window.location.reload();\n      }\n    };\n\n    this.ticketSubmit = async e => {\n      e.preventDefault();\n\n      if (Object.values(this.state.updates) != Object.values(this.state.original)) {\n        const {\n          users\n        } = this.props.user;\n        let userArr = users.map(user => user.name);\n\n        if (userArr.includes(this.state.updates.assignedTo)) {\n          let assignedToIndex = userArr.indexOf(this.state.updates.assignedTo);\n          const {\n            id\n          } = this.props.match.params;\n\n          if (this.state.updates.status !== this.state.original.status) {\n            this.commentPost(`Status is <em>${this.state.updates.status}</em> was <em>${this.state.original.status}</em>`);\n          }\n\n          const updatedTicket = {\n            description: this.state.updates.description,\n            customer: {\n              name: this.state.updates.customerName,\n              contact: this.state.updates.customerContact\n            },\n            status: this.state.updates.status,\n            assignedTo: {\n              id: users[assignedToIndex]._id,\n              name: this.state.updates.assignedTo\n            }\n          };\n          await this.props.updateTicket(id, updatedTicket);\n        } else {\n          alert('Invalid assigned to user');\n        }\n\n        window.location.reload();\n      }\n    };\n\n    this.commentSubmit = e => {\n      e.preventDefault();\n      this.commentPost(this.state.commentText);\n    };\n\n    this.isClosed = () => {\n      return this.state.open === 'Closed' ? \"disabled\" : \"\";\n    };\n  }\n\n  getTicket() {\n    const {\n      id\n    } = this.props.match.params;\n    axios.get(`/api/tickets/${id}`).then(res => this.setState({\n      title: res.data.title,\n      status: res.data.status,\n      open: res.data.open === true ? 'Open' : 'Closed',\n      created: res.data.createdAt,\n      updated: res.data.updatedAt,\n      description: res.data.description,\n      customerName: ((res.data || {}).customer || {}).name,\n      customerContact: ((res.data || {}).customer || {}).contact,\n      comments: res.data.comments,\n      author: ((res.data || {}).author || {}).name,\n      assignedTo: ((res.data || {}).assignedTo || {}).name,\n      original: {\n        title: res.data.title,\n        status: res.data.status,\n        open: res.data.open === true ? 'Open' : 'Closed',\n        created: res.data.createdAt,\n        updated: res.data.updatedAt,\n        description: res.data.description,\n        customerName: ((res.data || {}).customer || {}).name,\n        customerContact: ((res.data || {}).customer || {}).contact,\n        comments: res.data.comments,\n        author: ((res.data || {}).author || {}).name,\n        assignedTo: ((res.data || {}).assignedTo || {}).name\n      },\n      loading: false\n    })).catch(err => this.props.history.push('/'));\n  }\n\n  componentDidMount() {\n    if (this.props.errors) {\n      this.setState({\n        errors: this.props.errors\n      });\n    }\n\n    this.props.findUser();\n    this.getTicket();\n    this.setState({\n      loading: true\n    });\n  }\n\n  render() {\n    const {\n      users\n    } = this.props.user;\n    const {\n      loading\n    } = this.props.user;\n\n    if (this.state.loading === true && loading === true) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(LoadingScreen, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 21\n        }\n      }));\n    } else {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"datalist\", {\n        id: \"datalist1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 17\n        }\n      }, users.map(user => /*#__PURE__*/React.createElement(\"option\", {\n        key: user._id,\n        value: user.name,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(Table, {\n        className: \"my-4\",\n        bordered: true,\n        hover: true,\n        responsive: \"md\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 33\n        }\n      }, \"Title\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 33\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 33\n        }\n      }, \"State\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 33\n        }\n      }, \"Author\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 33\n        }\n      }, \"Created\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 33\n        }\n      }, \"Last Modified\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 33\n        }\n      }, this.state.updates.title), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 33\n        }\n      }, this.state.updates.status), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 33\n        }\n      }, this.state.updates.open === 'Open' ? 'Open' : 'Closed'), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 33\n        }\n      }, this.state.updates.author), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 33\n        }\n      }, this.state.updates.created.substring(0, 19)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 33\n        }\n      }, this.state.updates.updated.substring(0, 19))))), /*#__PURE__*/React.createElement(Form, {\n        onSubmit: this.ticketSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"updates.customerName\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 37\n        }\n      }, \"Customer Name\"), /*#__PURE__*/React.createElement(Form.Control, {\n        type: \"text\",\n        onChange: this.onChange,\n        value: this.state.updates.customerName,\n        placeholder: \"Customer's Name\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 37\n        }\n      }))), /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"updates.customerContact\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 37\n        }\n      }, \"Customer Contact\"), /*#__PURE__*/React.createElement(Form.Control, {\n        type: \"text\",\n        onChange: this.onChange,\n        value: this.state.updates.customerContact,\n        placeholder: \"Customer's Contact Info\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 37\n        }\n      })))), /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"updates.status\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 37\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(Form.Control, {\n        as: \"select\",\n        value: this.state.updates.status,\n        onChange: this.onChange,\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 41\n        }\n      }, \"New\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 41\n        }\n      }, \"Awaiting Customer Feedback\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 41\n        }\n      }, \"In Progress\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 41\n        }\n      }, \"Cancelled\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 41\n        }\n      }, \"Resolved\"))))), /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"updates.assignedTo\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 29\n        }\n      }, \"Assigned To\"), /*#__PURE__*/React.createElement(Form.Control, {\n        list: \"datalist1\",\n        type: \"text\",\n        value: this.state.updates.assignedTo,\n        onChange: this.onChange,\n        required: true,\n        placeholder: \"Assign ticket to user\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 29\n        }\n      })), /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"updates.description\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 29\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(Form.Control, {\n        as: \"textarea\",\n        value: this.state.updates.description,\n        onChange: this.onChange,\n        required: true,\n        placeholder: \"Ticket description\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 29\n        }\n      })), /*#__PURE__*/React.createElement(Button, {\n        variant: \"outline-primary\",\n        type: \"submit\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 25\n        }\n      }, \"Submit\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"my-4 commentForm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Form, {\n        onSubmit: this.commentSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Form.Group, {\n        controlId: \"commentText\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 29\n        }\n      }, \"New Comment\"), /*#__PURE__*/React.createElement(Form.Control, {\n        as: \"textarea\",\n        value: this.state.newComment,\n        onChange: this.onChange,\n        placeholder: \"Enter comments\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 29\n        }\n      })), /*#__PURE__*/React.createElement(Button, {\n        variant: \"outline-secondary\",\n        type: \"submit\",\n        disabled: this.isClosed(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 25\n        }\n      }, \"Post Comment\"))), this.state.updates.comments.map(comment => /*#__PURE__*/React.createElement(\"div\", {\n        key: comment._id,\n        className: \"mt-3 card-footer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-12\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 41\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 45\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-9\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 49\n        }\n      }, /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 75\n        }\n      }, comment.author.name)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"text-right col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 49\n        }\n      }, moment(comment.createdAt).fromNow())), /*#__PURE__*/React.createElement(\"p\", {\n        dangerouslySetInnerHTML: {\n          __html: sanitizer(comment.text)\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 45\n        }\n      }))))));\n    }\n  }\n\n}\n\nTicketPage.propTypes = {\n  updateTicket: PropTypes.func.isRequired,\n  addComment: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired,\n  errors: PropTypes.object.isRequired,\n  findUser: PropTypes.func.isRequired,\n  user: PropTypes.object.isRequired\n};\n\nconst mapStateToProps = state => ({\n  auth: state.auth,\n  errors: state.errors,\n  user: state.user\n});\n\nexport default connect(mapStateToProps, {\n  returnErrors,\n  updateTicket,\n  addComment,\n  findUser\n})(TicketPage);","map":{"version":3,"sources":["/Users/abhinav/Desktop/itilapp/client/src/components/ticketpage.js"],"names":["axios","React","Component","connect","updateTicket","returnErrors","addComment","findUser","PropTypes","LoadingScreen","Form","Button","Table","Row","Col","dompurify","moment","sanitizer","sanitize","TicketPage","state","status","created","open","updated","title","description","customerName","customerContact","author","comments","assignedTo","commentToggle","original","commentText","loading","errors","onChange","e","setState","target","id","value","commentPost","text","length","props","match","params","userId","auth","user","username","name","newComment","window","location","reload","ticketSubmit","preventDefault","Object","values","updates","users","userArr","map","includes","assignedToIndex","indexOf","updatedTicket","customer","contact","_id","alert","commentSubmit","isClosed","getTicket","get","then","res","data","createdAt","updatedAt","catch","err","history","push","componentDidMount","render","substring","comment","fromNow","__html","propTypes","func","isRequired","object","mapStateToProps"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { updateTicket } from '../actions/ticketActions';\nimport { returnErrors } from '../actions/errorActions';\nimport { addComment } from '../actions/commentActions';\nimport { findUser } from '../actions/userActions';\nimport PropTypes from 'prop-types';\nimport LoadingScreen from './loadingscreen';\nimport { Form, Button, Table, Row, Col } from 'react-bootstrap';\nimport dompurify from 'dompurify';\nimport moment from 'moment';\nconst sanitizer = dompurify.sanitize;\n\nclass TicketPage extends Component {\n    state = {\n            status: '',\n            created: '',\n            open: '',\n            updated: '',\n            title: '',\n            description: '',\n            customerName: '',\n            customerContact: '',\n            author: '',\n            comments:  [],\n            assignedTo: '',\n        commentToggle: false,\n        original: {\n            status: '',\n            created: '',\n            open: '',\n            updated: '',\n            title: '',\n            description: '',\n            customerName: '',\n            customerContact: '',\n            author: '',\n            comments:  [],\n            assignedTo: ''\n        },\n        commentText: '',\n        loading: false,\n        errors: {}\n    }\n\n    getTicket() {\n        const { id } = this.props.match.params;\n        axios\n            .get(`/api/tickets/${id}`)\n            .then(res => \n                this.setState({\n                    title: res.data.title,\n                    status: res.data.status,\n                    open: (res.data.open === true) ? 'Open' : 'Closed',\n                    created: res.data.createdAt,\n                    updated: res.data.updatedAt,\n                    description: res.data.description,\n                    customerName: ((res.data || {}).customer || {}).name,\n                    customerContact: ((res.data || {}).customer || {}).contact,\n                    comments: res.data.comments,\n                    author: ((res.data || {}).author || {}).name,\n                    assignedTo: ((res.data || {}).assignedTo || {}).name,\n                    original: {\n                        title: res.data.title,\n                        status: res.data.status,\n                        open: (res.data.open === true) ? 'Open' : 'Closed',\n                        created: res.data.createdAt,\n                        updated: res.data.updatedAt,\n                        description: res.data.description,\n                        customerName: ((res.data || {}).customer || {}).name,\n                        customerContact: ((res.data || {}).customer || {}).contact,\n                        comments: res.data.comments,\n                        author: ((res.data || {}).author || {}).name,\n                        assignedTo: ((res.data || {}).assignedTo || {}).name,\n                    },\n                    loading: false\n                })\n            )\n            .catch(err => \n                this.props.history.push('/')\n        );\n    }\n\n    componentDidMount() {\n        if (this.props.errors) {\n            this.setState({ errors: this.props.errors })\n        }\n        this.props.findUser();\n        this.getTicket();\n        this.setState({ loading: true })\n    }\n\n    onChange = (e) => {\n        this.setState({ [e.target.id] : e.target.value })\n    }\n\n    commentPost = async (text) => {\n        if(text.length > 0){\n        const { id } = this.props.match.params;\n        const userId = this.props.auth.user.id;\n        const username = this.props.auth.user.name;\n        const newComment = {\n            text: text,\n            author: {\n                id: userId,\n                name: username\n            }\n        }\n        await this.props.addComment(id, newComment);\n        window.location.reload();\n    }\n    }\n\n    ticketSubmit = async (e) => {\n        e.preventDefault();\n        if (Object.values(this.state.updates) != Object.values(this.state.original)) {\n            const { users } = this.props.user;\n            let userArr = users.map(user => user.name);\n            if (userArr.includes(this.state.updates.assignedTo)){\n                let assignedToIndex = userArr.indexOf(this.state.updates.assignedTo)\n                const { id } = this.props.match.params;\n                if (this.state.updates.status !== this.state.original.status) {\n                    this.commentPost(`Status is <em>${this.state.updates.status}</em> was <em>${this.state.original.status}</em>`)\n                }\n                const updatedTicket = {\n                    description: this.state.updates.description,\n                    customer: {\n                        name: this.state.updates.customerName,\n                        contact: this.state.updates.customerContact\n                    },\n                    status: this.state.updates.status,\n                    assignedTo: {\n                        id: users[assignedToIndex]._id,\n                        name: this.state.updates.assignedTo\n                    }\n                }\n                await this.props.updateTicket(id, updatedTicket);\n            } else {\n                alert('Invalid assigned to user')\n            }\n            window.location.reload();\n    }\n    }\n\n    commentSubmit = (e) => {\n        e.preventDefault();\n        this.commentPost(this.state.commentText)\n    }\n\n    isClosed = () => {\n        return this.state.open === 'Closed' ? \"disabled\" : \"\";\n    }\n\n    render() {\n        const { users } = this.props.user;\n        const { loading } = this.props.user;\n        if (this.state.loading === true && loading === true) {\n            return (\n                <div className='container'>\n                    <LoadingScreen />\n                </div>\n            )\n        } else {\n            return (\n                <div className='container'>\n                <datalist id='datalist1'>\n                {\n                    users.map(user => (\n                        <option key={user._id} value={user.name}></option>\n                ))}\n                </datalist>\n                    <Table className='my-4' bordered hover responsive='md'>\n                        <thead>\n                            <tr>\n                                <td>Title</td>\n                                <td>Status</td>\n                                <td>State</td>\n                                <td>Author</td> \n                                <td>Created</td>\n                                <td>Last Modified</td>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>{this.state.updates.title}</td>\n                                <td>{this.state.updates.status}</td>\n                                <td>{(this.state.updates.open === 'Open') ? 'Open' : 'Closed'}</td>\n                                <td>{this.state.updates.author}</td>\n                                <td>{this.state.updates.created.substring(0,19)}</td>\n                                <td>{this.state.updates.updated.substring(0,19)}</td>\n                            </tr>\n                        </tbody>\n                    </Table>\n                    <Form onSubmit={this.ticketSubmit}>\n                        <Row>\n                            <Col>\n                                <Form.Group controlId=\"updates.customerName\">\n                                    <Form.Label>Customer Name</Form.Label>\n                                    <Form.Control type='text' onChange={this.onChange} value={this.state.updates.customerName} placeholder=\"Customer's Name\" disabled={this.isClosed()} />\n                                </Form.Group>\n                            </Col>\n                            <Col>\n                                <Form.Group controlId=\"updates.customerContact\">\n                                    <Form.Label>Customer Contact</Form.Label>\n                                    <Form.Control type='text' onChange={this.onChange} value={this.state.updates.customerContact} placeholder=\"Customer's Contact Info\" disabled={this.isClosed()} />\n                                </Form.Group>\n                            </Col>\n                        </Row>\n                        <Row>\n                            <Col>\n                                <Form.Group controlId='updates.status'>\n                                    <Form.Label>Status</Form.Label>\n                                    <Form.Control as='select' value={this.state.updates.status} onChange={this.onChange} disabled={this.isClosed()}>\n                                        <option>New</option>\n                                        <option>Awaiting Customer Feedback</option>\n                                        <option>In Progress</option>\n                                        <option>Cancelled</option>\n                                        <option>Resolved</option>\n                                    </Form.Control>\n                                </Form.Group>\n                            </Col>\n                        </Row>\n                        <Form.Group controlId='updates.assignedTo'>\n                            <Form.Label>Assigned To</Form.Label>\n                            <Form.Control  list='datalist1' type='text' value={this.state.updates.assignedTo} onChange={this.onChange} required placeholder='Assign ticket to user' disabled={this.isClosed()} />\n                        </Form.Group>\n                        <Form.Group controlId='updates.description'>\n                            <Form.Label>Description</Form.Label>\n                            <Form.Control as='textarea' value={this.state.updates.description} onChange={this.onChange} required placeholder=\"Ticket description\" disabled={this.isClosed()} />\n                        </Form.Group>\n                        <Button variant='outline-primary' type='submit' disabled={this.isClosed()} >Submit</Button>\n                    </Form>\n                    <div className='my-4 commentForm'>\n                        <Form onSubmit={this.commentSubmit}>\n                        <Form.Group controlId='commentText'>\n                            <Form.Label>New Comment</Form.Label>\n                            <Form.Control as='textarea' value={this.state.newComment} onChange={this.onChange} placeholder=\"Enter comments\"  disabled={this.isClosed()} />\n                        </Form.Group>\n                        <Button variant='outline-secondary' type='submit' disabled={this.isClosed()}>Post Comment</Button>\n                        </Form>\n                    </div>\n                        {this.state.updates.comments.map(comment =>\n                            <div key={comment._id} className='mt-3 card-footer'> \n                                <div className='row'>\n                                        <div className='col-md-12'>\n                                            <div className='row'>\n                                                <div className='col-md-9'><strong>{comment.author.name}</strong></div>\n                                                <div className='text-right col-md-3'>{moment(comment.createdAt).fromNow()}</div>\n                                            </div>\n                                            <p dangerouslySetInnerHTML={{__html: sanitizer(comment.text)}}></p>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n            )\n        }\n    }\n}\n\nTicketPage.propTypes = {\n    updateTicket: PropTypes.func.isRequired,\n    addComment: PropTypes.func.isRequired,\n    auth: PropTypes.object.isRequired,\n    errors: PropTypes.object.isRequired,\n    findUser: PropTypes.func.isRequired,\n    user: PropTypes.object.isRequired\n}\n\nconst mapStateToProps = (state) => ({\n    auth: state.auth,\n    errors: state.errors,\n    user: state.user\n});\n\nexport default connect(mapStateToProps, { returnErrors, updateTicket, addComment, findUser })(TicketPage)"]},"metadata":{},"sourceType":"module"}